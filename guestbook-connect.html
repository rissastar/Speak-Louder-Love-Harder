function postMessage() {
  const user = localStorage.getItem("currentUser");
  if (!user) {
    alert("You must be logged in to post.");
    return;
  }

  const message = document.getElementById("guestMessage").value.trim();
  if (!message) return alert("Please enter a message!");

  const messages = JSON.parse(localStorage.getItem("guestbook") || "[]");
  const newMessage = {
    id: Date.now(),
    user,
    text: message
  };

  messages.unshift(newMessage);
  localStorage.setItem("guestbook", JSON.stringify(messages));
  document.getElementById("guestMessage").value = "";
  loadMessages();
}

function loadMessages() {
  const user = localStorage.getItem("currentUser");
  const messages = JSON.parse(localStorage.getItem("guestbook") || "[]");
  const container = document.getElementById("guestbookMessages");
  container.innerHTML = "";

  messages.forEach(msg => {
    const div = document.createElement("div");
    div.className = "message-box";
    div.innerHTML = `
      <p><strong>${msg.user}</strong> says:</p>
      <p>${msg.text}</p>
    `;

    if (msg.user === user) {
      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.className = "delete-btn";
      delBtn.onclick = () => deleteMessage(msg.id);
      div.appendChild(delBtn);
    }

    container.appendChild(div);
  });
}

function deleteMessage(id) {
  let messages = JSON.parse(localStorage.getItem("guestbook") || "[]");
  const user = localStorage.getItem("currentUser");

  messages = messages.filter(m => !(m.id === id && m.user === user));
  localStorage.setItem("guestbook", JSON.stringify(messages));
  loadMessages();
}

document.addEventListener("DOMContentLoaded", () => {
  if (document.getElementById("guestbookMessages")) {
    loadMessages();
  }
});